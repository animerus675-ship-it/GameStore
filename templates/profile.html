{% extends "layout/base.html" %}
{% load static %}

{% block title %}Profile{% endblock %}

{% block content %}
<div class="page-heading header-text">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h3>Profile</h3>
        <span class="breadcrumb"><a href="{% url 'home' %}">Home</a> &gt; Profile</span>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="container profile-page">
    <div class="profile-card">
      <div class="profile-main">
        <div class="profile-avatar-wrap">
          {% if profile.avatar %}
            <img src="{{ profile.avatar.url }}" alt="Avatar" class="profile-page-avatar">
          {% else %}
            <img src="{% static 'images/avatar.png' %}" alt="Avatar" class="profile-page-avatar">
          {% endif %}
          <form id="avatar-upload-form" method="post" enctype="multipart/form-data" class="avatar-upload-form">
            {% csrf_token %}
            <input id="avatar-input" type="file" name="avatar" accept="image/jpeg,image/png,image/webp" hidden>
            <button type="button" id="avatar-select-btn" class="btn btn-outline-primary btn-sm">Change photo</button>
          </form>
        </div>
        <div class="profile-info">
          <h4>{{ user.username }}</h4>
          <p>{{ user.email|default:"Email not specified" }}</p>
          <div class="profile-stats">
            <span class="profile-badge"><i class="fa fa-heart"></i> Favorites: {{ favorites_count }}</span>
            <span class="profile-badge"><i class="fa fa-shopping-cart"></i> Cart: {{ cart_count }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="profile-actions-grid">
      <a href="{% url 'cart_detail' %}" class="profile-action-card">
        <div class="profile-action-icon"><i class="fa fa-shopping-cart"></i></div>
        <h5>Cart</h5>
        <p>Review selected games and proceed to checkout.</p>
      </a>
      <a href="{% url 'favorites_list' %}" class="profile-action-card">
        <div class="profile-action-icon"><i class="fa fa-heart"></i></div>
        <h5>Favorites</h5>
        <p>Saved games list for quick access.</p>
      </a>
      <a href="{% url 'password_change' %}" class="profile-action-card">
        <div class="profile-action-icon"><i class="fa fa-lock"></i></div>
        <h5>Change Password</h5>
        <p>Update your account password.</p>
      </a>
      <a href="{% url 'logout' %}" class="profile-action-card profile-action-danger">
        <div class="profile-action-icon"><i class="fa fa-sign-out"></i></div>
        <h5>Exit</h5>
        <p>End your current account session.</p>
      </a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  (function () {
    var selectBtn = document.getElementById("avatar-select-btn");
    var input = document.getElementById("avatar-input");
    var form = document.getElementById("avatar-upload-form");
    if (!selectBtn || !input || !form) return;

    selectBtn.addEventListener("click", function () {
      input.click();
    });

    input.addEventListener("change", function () {
      if (input.files && input.files.length > 0) {
        form.submit();
      }
    });
  })();
</script>
{% endblock %}
