{% extends "layout/base.html" %}

{% block title %}Lugx Gaming - Shop{% endblock %}

{% block content %}
<div class="page-heading header-text">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h3>Our Shop</h3>
        <span class="breadcrumb"><a href="{% url 'home' %}">Home</a> &gt; Our Shop</span>
      </div>
    </div>
  </div>
</div>

<div class="section trending">
  <div class="container">
    <form method="get" class="mb-4">
      <div class="row g-3">
        <div class="col-lg-3 col-md-6">
          <input
            type="text"
            name="q"
            class="form-control"
            placeholder="Поиск по названию"
            value="{{ q }}"
          >
        </div>
        <div class="col-lg-3 col-md-6">
          <select name="genre" class="form-select">
            <option value="">Все жанры</option>
            {% for item in genres %}
              <option value="{{ item.slug }}" {% if genre == item.slug %}selected{% endif %}>{{ item.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-lg-3 col-md-6">
          <select name="platform" class="form-select">
            <option value="">Все платформы</option>
            {% for item in platforms %}
              <option value="{{ item.slug }}" {% if platform == item.slug %}selected{% endif %}>{{ item.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-lg-2 col-md-6">
          <select name="sort" class="form-select">
            <option value="">Сначала новые</option>
            <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Сначала новые</option>
            <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Цена по возрастанию</option>
            <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Цена по убыванию</option>
          </select>
        </div>
        <div class="col-lg-1 col-md-12 d-grid">
          <button type="submit" class="btn btn-primary">OK</button>
        </div>
      </div>
    </form>

    <div class="row">
      {% for game in games %}
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="item h-100">
            <div class="down-content">
              <span class="category">{{ game.publisher.name|default:"No Publisher" }}</span>
              <h4>{{ game.title }}</h4>
              <p class="mb-2">Цена: ${{ game.price }}</p>
              <p class="mb-3">Рейтинг: {{ game.average_rating|default_if_none:"0"|floatformat:1 }}</p>
              <a class="main-button" href="{% url 'product_detail' game.slug %}">Подробнее</a>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
          <p>Игры не найдены</p>
        </div>
      {% endfor %}
    </div>

    {% if games.paginator.num_pages > 1 %}
      <div class="row">
        <div class="col-lg-12">
          <ul class="pagination">
            {% if games.has_previous %}
              <li>
                <a href="?{% if query_string %}{{ query_string }}&amp;{% endif %}page={{ games.previous_page_number }}">&lt;</a>
              </li>
            {% endif %}

            {% for page_num in games.paginator.page_range %}
              <li>
                <a
                  href="?{% if query_string %}{{ query_string }}&amp;{% endif %}page={{ page_num }}"
                  class="{% if games.number == page_num %}is_active{% endif %}"
                >{{ page_num }}</a>
              </li>
            {% endfor %}

            {% if games.has_next %}
              <li>
                <a href="?{% if query_string %}{{ query_string }}&amp;{% endif %}page={{ games.next_page_number }}">&gt;</a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
